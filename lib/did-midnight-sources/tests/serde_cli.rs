#![cfg(feature = "serde-cli")]

use std::str::FromStr;

use identus_did_midnight::did::MidnightDid;
use identus_did_midnight::dlt::{ContractState, ContractStateDecoder};
use identus_did_midnight_sources::serde_cli::CliContractStateDecoder;

const CLI_PATH: &str = "did-midnight-serde";

#[test]
#[ignore]
fn test_midnight_serde_cli() {
    let did = MidnightDid::from_str(
        "did:midnight:undeployed:02000ea0f6a091431f1bc5de34ba3db832c1b1bc38d0d08faedd9b9c1d50f2a4e9fe",
    )
    .unwrap();
    let state = ContractState::from_str("0003000202ee0101130000000000000000000000250000000160010ea0f6a091431f1bc5de34ba3db832c1b1bc38d0d08faedd9b9c1d50f2a4e9fe20010100000020000000dba59feb6cb425f6a75ef967004c91be5e49aef8c632a7dc69eb23cb902d770e010000000100000000030000000101080100000020000000b475b22139ade88ce78c5a36254fdc7ae5192b9914930a369b84bd8dd8c1db06010000000100000000030000000140080100000020000000b00f90815436642458d57a3833a1e19d2f058346c1db6b7a07355e8575d15c330100000001000000000300000001010101000000200000000261e0060edac43cd5c55d4efd8b0c1292726c37f20912368c7a7a9322d127c00100000001000000006500000062036469643a6d69646e696768743a756e6465706c6f7965643a3032303030656130663661303931343331663162633564653334626133646238333263316231626333386430643038666165646439623963316435306632613465396665236b65792d31400000000074000000018662036469643a6d69646e696768743a756e6465706c6f7965643a3032303030656130663661303931343331663162633564653334626133646238333263316231626333386430643038666165646439623963316435306632613465396665236b65792d31024040412a4154c6400101014141020000002000000044cc2a4f912c69af77bced44d4f3bf96a4ead8f6170eef7061cab7b2b4b87c782000000013c26bb59a594501e4c3b3cf77f73fecb610650a6d5d29b7ad5e346d41c76d1600000000010000002000000054f071ec5141a0f9a765729ebebf174e7c87af416995b353ac4fddce4f0ebfc701000000010100000020000000a035ce7d0680e9f731c17fedf5185a1f3ea9fc7c3396dd495163948bb15f10d72a00000003482400000020000000807ccab4888d5e6211765f5a82445b4725272342fa7ee81b14d8fd060c7b15b50100000020000000a040adecada05c78c82e96c4c59a7537b034850f2597ca0223f7ae09dc55a81c01000000020100000020000000c89a82010ca3b72b9eeb063d812b91dd78f6dc37a7f834b6704833035baac97601000000010000000001000000000100000020000000957b88b12730e646e0f33d3618b77dfa579e8231e3c59c7104be7165611c80270100000002010000002000000075ad752a539ff58fc415c3c8a5b84b1b69726295a878cb1cd913d43fddff38a601000000011000000020000000005995ae3e7613986c9d24be32ae3394f8b222cce2d0f8c416c876a0a2ea5ac62000000017de4b19c7724325d8946251879b932f59066dc5cb9c52a751521e4888cd322c20000000e17a2aad4fca043cf8592a20dfd4e0b898d803dd9b2fc51bb6298767f39f8acf20000000e17a2aad4fca043cf8592a20dfd4e0b898d803dd9b2fc51bb6298767f39f8acf20000000e17a2aad4fca043cf8592a20dfd4e0b898d803dd9b2fc51bb6298767f39f8acf200000006318593afe78a287ebc01d42bc861ca4ea2d4a5968f0dc423f001fc85fa3adef2000000017de4b19c7724325d8946251879b932f59066dc5cb9c52a751521e4888cd322c20000000bc5caa8df6ebb578eef15b4088b4fbc6afa6b48de7e17759743c79cd6e9878b0200000004207919aaf473eeaf59ea23caab818f1d52f72b1878d6eb8b123f22e1de3f9c4200000004207919aaf473eeaf59ea23caab818f1d52f72b1878d6eb8b123f22e1de3f9c4200000004207919aaf473eeaf59ea23caab818f1d52f72b1878d6eb8b123f22e1de3f9c4200000004207919aaf473eeaf59ea23caab818f1d52f72b1878d6eb8b123f22e1de3f9c4200000004207919aaf473eeaf59ea23caab818f1d52f72b1878d6eb8b123f22e1de3f9c4200000004207919aaf473eeaf59ea23caab818f1d52f72b1878d6eb8b123f22e1de3f9c420000000957b88b12730e646e0f33d3618b77dfa579e8231e3c59c7104be7165611c802720000000957b88b12730e646e0f33d3618b77dfa579e8231e3c59c7104be7165611c802701000000020101050000000000000000000000130000000f0000006170706c794f7065726174696f6e7300000000c2040000010400bb040000024a0c0000030e12000000a0d819c772e19d237a5ac49079c6c9fc0c46b06f603433bf41298440153b6f9c0de5d022b7009b447ab0062b06b368b882d1305a43e2623a998d697b0874e9a940e5062aef293ee81f837b632a3e016cf6507f72bbbcbb71a80d4b6d8e1bdb1281b3d84adc8f0adf1fbabc82a274f96e1e2cdcca2d47a1b5835ae230942ba1cbc2f10c3dc86ef0f883e604c6833f6b94a0ab4b10c8719769a73d6d61cb46ce644cd8636b6c4868f2fb9dc833e1a39235113ab6f1bdc0c073cb9ab0e59bf855f28fbf2221a719fc35126d2b948d2f32edc5999c19ec54a5667fd74796bbfe12befcf6ad3d0eec0735c3b808d726a451a5af774ac0fa41002c39fa23e9bf2e70d65195c4f36e2830c3d4341a0d735b0037f215575053495487bfc722bd1e85ef809000d2958abdc6f22c46317c6bd49ab7313eb37a2caffb7120fafc73c1deeedda634324d2e48b1fa8fc0f347c0c1d73b97704c69762b86c4eda94af0b454d074840406cbc641a26383dd9d3e16963f5de16902bbb8e685c070d219d1ad103f2189131cb20e549799620b10dab366a7b272723ba9c1944b57186d0c23009fc62f6d5952267036941ce2b0b20a160e99a198e7ab47afb9429480b9bf7b9839c6591c8206270f741ad62c81604971b97b00256294c58907cedcb5464a00551a23cd8fae6b83d7069dcfced7544e10afb788fb6f1fc49b078f49f96ae356e6769bceb9d9c7994c5b7e5a3407d6458efcf73dada8bab8561e42e4b9da01ab58d429d1da76df7db451e83018968de8fd01f6d6124a4634b868fd32fa8a34126f591296c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a729bfdef21f754909870f7513cc32e723e901bb47f0cf595a437a088807b678e4885f2b21037e83d6258e304482a1ee94c0db6096c90f22c5a91677093ab564e6ee1b48881f89f37f885f3f03f489b63b165dbe31e6e98b5140652b7eb408bab22c019304d742a97d0752db8e3f6658c59f95b7f3cc328693b8e42349a363b4073d712f9874f3b93898b62f0733967491eb7838aaad997275946bb0042b8bd57f0d0af92ac9f1127d8096a20d18258035f0b9f3e8cdc2c2a43b10eb365287658fe2da66a1c9ee49d2b8c5bd4b2dfd2335dd80982b070ca435b94aa486d393bb32e040038ae5ce22a0f953cb3e6fa690b72a69c21f58d5d91aded0c5febefb07aa62251db89c2f44611f065415a35c89cdbded214b3e6dcac8e87b0f16e669a78727f85c1ae39b67a16e70621723eaabb14cf6c7e90e8956fd5f3fbc5e476944e6de180ea439bc890f117e5ace9be85e817ccc61a7edfc59502d3c6b094516eb39b24e471558823c6f3ee25f578bbd81c2b3461fc1ea10a4105e082e12358928a1720867e8d336f6baae730b61ebb42d242faf616459ee92842cb539a38c9e1561e9d2d9feb0e111079e3b406c9025f3b8faec88775cd2ccc7994095eefe337adf4dd88b16c4dfdea027987742d250e3a18b82e0bca1f89f4d5bd19fdec21cb8aea6214441825600fcc619c9abea36c2fc64e45370826493ba0721a7775e6cc16b6d911ef4994f69177261b77283865899508b48fdb2975eb118421b6a1906746abfee37a2564e1467c236d58174d40a090900bdcb6103b0d9709c55193eaf760200000020000000a2ca65b3fbe5cefaf94d132f03babd7bf24edc09af4ea0f8891b2f687564d2db200000003d4fbce8dea6518dc248d28c334b8010db7dafd77b3aff4296029767951a1caa000000000100000020000000bd95c679b5cea7d2b3401064599083eeb2094828c1ae4a77e996929506ae32d3010000000101000000200000007391782684ea0f0d86ff3cffc7ac30973ec93344ca31b34426eebd66d670d86e2a00000003482400000020000000b19f417cb92e09b0a2f57c7f3918abe7423af9bc08fac61c45a9f785874f28d901000100000001004940ef4fe1f4fc0376f36fe24bf4531aee71211d5c8a0ea0fae369797cae2e000100000000000000").unwrap();
    let decoder = CliContractStateDecoder::new(CLI_PATH);
    let did_doc = decoder.decode(&did, state).unwrap();

    assert!(did_doc.context.is_empty());
    assert_eq!(
        did_doc.id.to_string(),
        "did:midnight:undeployed:02000ea0f6a091431f1bc5de34ba3db832c1b1bc38d0d08faedd9b9c1d50f2a4e9fe"
    );
    assert_eq!(did_doc.verification_method[0].r#type, "JubJubVerificationKey2025");
    assert_eq!(
        did_doc.verification_method[0].controller,
        "did:midnight:undeployed:02000ea0f6a091431f1bc5de34ba3db832c1b1bc38d0d08faedd9b9c1d50f2a4e9fe"
    );
}
