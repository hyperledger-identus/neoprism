# Code generated by Python script. DO NOT EDIT.
services:
  neoprism-standalone:
    image: hyperledgeridentus/identus-neoprism:0.7.0
    restart: always
    ports:
    - 18080:8080
    command:
    - standalone
    environment:
      RUST_LOG: oura=warn,tracing::span=warn,info
      NPRISM_DB_URL: postgres://postgres:postgres@db-neoprism:5432/postgres
      NPRISM_CARDANO_NETWORK: mainnet
      NPRISM_CONFIRMATION_BLOCKS: '0'
      NPRISM_INDEX_INTERVAL: '1'
      NPRISM_CARDANO_DBSYNC_URL: postgresql://postgres:postgres@db-dbsync:5432/postgres
      NPRISM_CARDANO_DBSYNC_POLL_INTERVAL: '1'
      NPRISM_CARDANO_WALLET_BASE_URL: http://cardano-wallet:8090/v2
      NPRISM_CARDANO_WALLET_WALLET_ID: 9263a1248b046fe9e1aabc4134b03dc5c3a7ee3d
      NPRISM_CARDANO_WALLET_PASSPHRASE: super_secret
      NPRISM_CARDANO_WALLET_PAYMENT_ADDR: addr_test1qp83v2wq3z9mkcjj5ejlupgwt6tcly5mtmz36rpm8w4atvqd5jzpz23y8l4dwfd9l46fl2p86nmkkx5keewdevqxhlyslv99j3
    depends_on:
      db-neoprism:
        condition: service_healthy
      cardano-wallet:
        condition: service_healthy
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8080/api/_system/health
      interval: 2s
      timeout: 5s
      retries: 30
  prism-node:
    image: ghcr.io/input-output-hk/prism-node:2.6.1
    restart: always
    ports:
    - 50053:50053
    environment:
      NODE_PSQL_HOST: db-prism-node:5432
      NODE_PSQL_DATABASE: postgres
      NODE_PSQL_USERNAME: postgres
      NODE_PSQL_PASSWORD: postgres
      NODE_LEDGER: cardano
      NODE_CARDANO_CONFIRMATION_BLOCKS: '0'
      NODE_REFRESH_AND_SUBMIT_PERIOD: 1s
      NODE_MOVE_SCHEDULED_TO_PENDING_PERIOD: 1s
      NODE_SCHEDULE_SYNC_PERIOD: 1s
      NODE_CARDANO_NETWORK: testnet
      NODE_CARDANO_WALLET_PASSPHRASE: super_secret
      NODE_CARDANO_WALLET_ID: 9263a1248b046fe9e1aabc4134b03dc5c3a7ee3d
      NODE_CARDANO_PAYMENT_ADDRESS: addr_test1qp83v2wq3z9mkcjj5ejlupgwt6tcly5mtmz36rpm8w4atvqd5jzpz23y8l4dwfd9l46fl2p86nmkkx5keewdevqxhlyslv99j3
      NODE_CARDANO_WALLET_API_HOST: cardano-wallet
      NODE_CARDANO_WALLET_API_PORT: '8090'
      NODE_CARDANO_PRISM_GENESIS_BLOCK: '0'
      NODE_CARDANO_DB_SYNC_HOST: db-dbsync:5432
      NODE_CARDANO_DB_SYNC_DATABASE: postgres
      NODE_CARDANO_DB_SYNC_USERNAME: postgres
      NODE_CARDANO_DB_SYNC_PASSWORD: postgres
    depends_on:
      db-prism-node:
        condition: service_healthy
      db-dbsync:
        condition: service_healthy
      cardano-wallet:
        condition: service_healthy
      bootstrap-testnet:
        condition: service_completed_successfully
  db-neoprism:
    image: postgres:16
    restart: always
    environment:
      POSTGRES_DB: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_USER: postgres
    healthcheck:
      test:
      - CMD
      - pg_isready
      - -U
      - postgres
      interval: 2s
      timeout: 5s
      retries: 30
  db-dbsync:
    image: postgres:16
    restart: always
    environment:
      POSTGRES_DB: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_USER: postgres
    healthcheck:
      test:
      - CMD
      - pg_isready
      - -U
      - postgres
      interval: 2s
      timeout: 5s
      retries: 30
  db-prism-node:
    image: postgres:16
    restart: always
    environment:
      POSTGRES_DB: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_USER: postgres
    healthcheck:
      test:
      - CMD
      - pg_isready
      - -U
      - postgres
      interval: 2s
      timeout: 5s
      retries: 30
  cardano-node:
    image: patextreme/cardano-testnet:20251111-145358
    command:
    - initTestnet
    environment:
      CARDANO_NODE_SOCKET_PATH: /node/testnet/socket/node1/sock
      CARDANO_NODE_NETWORK_ID: '42'
    volumes:
    - node-testnet:/node/testnet
    healthcheck:
      test:
      - CMD-SHELL
      - cardano-cli query tip
      interval: 2s
      timeout: 5s
      retries: 30
  bootstrap-testnet:
    image: patextreme/cardano-testnet:20251111-145358
    command:
    - bash
    - -c
    - 'transactGenesis

      hurl ./init-wallet.hurl

      hurl ./init-did.hurl


      # blockfrost-ryo expects a different location

      cp testnet/conway-genesis.json testnet/genesis.json

      cp testnet/byron-genesis.json testnet/byron_genesis.json

      '
    environment:
      HURL_WALLET_BASE_URL: http://cardano-wallet:8090/v2
      HURL_WALLET_PASSPHRASE: super_secret
      GENESIS_PAYMENT_ADDR: addr_test1qp83v2wq3z9mkcjj5ejlupgwt6tcly5mtmz36rpm8w4atvqd5jzpz23y8l4dwfd9l46fl2p86nmkkx5keewdevqxhlyslv99j3
      CARDANO_NODE_SOCKET_PATH: /node/testnet/socket/node1/sock
      CARDANO_NODE_NETWORK_ID: '42'
    volumes:
    - node-testnet:/node/testnet
    - ./init-wallet.hurl:/node/init-wallet.hurl
    - ./init-did.hurl:/node/init-did.hurl
    depends_on:
      cardano-node:
        condition: service_healthy
  cardano-dbsync:
    image: ghcr.io/intersectmbo/cardano-db-sync:13.6.0.5
    restart: always
    command:
    - --config
    - /config/dbsync-config.yaml
    - --socket-path
    - /node/testnet/socket/node1/sock
    - --force-indexes
    environment:
      POSTGRES_HOST: db-dbsync
      POSTGRES_DB: postgres
      POSTGRES_PORT: '5432'
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    volumes:
    - node-testnet:/node/testnet
    - ./dbsync-config.yaml:/config/dbsync-config.yaml
    depends_on:
      cardano-node:
        condition: service_healthy
      db-dbsync:
        condition: service_healthy
  cardano-wallet:
    image: cardanofoundation/cardano-wallet:2025.3.31
    restart: always
    ports:
    - 18081:8090
    command:
    - bash
    - -c
    - "cardano-wallet serve \\\n  --database /wallet/db \\\n  --node-socket /node/testnet/socket/node1/sock\
      \ \\\n  --testnet /node/testnet/byron-genesis.json \\\n  --listen-address 0.0.0.0\n"
    entrypoint: []
    volumes:
    - node-testnet:/node/testnet
    depends_on:
      cardano-node:
        condition: service_healthy
    healthcheck:
      test:
      - CMD-SHELL
      - cardano-wallet network information
      interval: 2s
      timeout: 5s
      retries: 30
  cardano-submit-api:
    image: ghcr.io/intersectmbo/cardano-submit-api:10.4.1
    restart: always
    command:
    - --config
    - /config.yaml
    - --socket-path
    - /node/testnet/socket/node1/sock
    - --testnet-magic
    - '42'
    - --listen-address
    - 0.0.0.0
    volumes:
    - node-testnet:/node/testnet
    - ./cardano-submit-api.yaml:/config.yaml
    depends_on:
      cardano-node:
        condition: service_healthy
  bf-proxy:
    image: caddy:2.10.2
    restart: always
    ports:
    - 18082:3000
    volumes:
    - ./Caddyfile-blockfrost:/etc/caddy/Caddyfile
  bf-ryo:
    image: blockfrost/backend-ryo:v4.3.0
    restart: always
    environment:
      BLOCKFROST_CONFIG_DBSYNC_HOST: db-dbsync
      BLOCKFROST_CONFIG_DBSYNC_PORT: '5432'
      BLOCKFROST_CONFIG_DBSYNC_DATABASE: postgres
      BLOCKFROST_CONFIG_DBSYNC_USER: postgres
      BLOCKFROST_CONFIG_DBSYNC_PASSWORD: postgres
      BLOCKFROST_CONFIG_NETWORK: custom
      BLOCKFROST_MITHRIL_ENABLED: 'false'
      NODE_ENV: development
      BLOCKFROST_CONFIG_GENESIS_DATA_FOLDER: /node/testnet
    volumes:
    - ./ryo.yaml:/app/config/development.yaml
    - node-testnet:/node/testnet
    depends_on:
      db-dbsync:
        condition: service_healthy
      bootstrap-testnet:
        condition: service_completed_successfully
volumes:
  node-testnet: {}
